# function handling everything that needs to happen between games

# increment timer
scoreboard players add stmc.handler event.timer.bg1 1

# run functions
function lobby:points_update
function lobby:sidebar

# run ranking calculations
execute if score stmc.handler event.timer.bg1 matches 1 run function lobby:calculate_rankings

# announce rankings

# team rankings
execute if score stmc.handler event.timer.bg1 matches 100 run tellraw @a [{"text":"Team Rankings:","color":"gold","bold":true}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.RedRaccoons stats.points.team.rank matches 1 run tellraw @a [{text:"#1: ",color:gold},{text:"Red Raccoons",color:red},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:red},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.OrangeOtters stats.points.team.rank matches 1 run tellraw @a [{text:"#1: ",color:gold},{text:"Orange Otters",color:gold},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:gold},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PinkPikas stats.points.team.rank matches 1 run tellraw @a [{text:"#1: ",color:gold},{text:"Pink Pikas",color:light_purple},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:light_purple},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.GreenGoats stats.points.team.rank matches 1 run tellraw @a [{text:"#1: ",color:gold},{text:"Green Goats",color:dark_green},{text:" - ",color:gold},{score:{name:"team.GreenGoats",objective:"stats.points.team"},color:dark_green},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.CyanCougars stats.points.team.rank matches 1 run tellraw @a [{text:"#1: ",color:gold},{text:"Cyan Cougars",color:dark_aqua},{text:" - ",color:gold},{score:{name:"team.CyanCougars",objective:"stats.points.team"},color:dark_aqua},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PurplePenguins stats.points.team.rank matches 1 run tellraw @a [{text:"#1: ",color:gold},{text:"Purple Penguins",color:dark_purple},{text:" - ",color:gold},{score:{name:"team.PurplePenguins",objective:"stats.points.team"},color:dark_purple},{text:" points",color:gold}]

execute if score stmc.handler event.timer.bg1 matches 100 if score team.RedRaccoons stats.points.team.rank matches 2 run tellraw @a [{text:"#2: ",color:gold},{text:"Red Raccoons",color:red},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:red},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.OrangeOtters stats.points.team.rank matches 2 run tellraw @a [{text:"#2: ",color:gold},{text:"Orange Otters",color:gold},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:gold},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PinkPikas stats.points.team.rank matches 2 run tellraw @a [{text:"#2: ",color:gold},{text:"Pink Pikas",color:light_purple},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:light_purple},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.GreenGoats stats.points.team.rank matches 2 run tellraw @a [{text:"#2: ",color:gold},{text:"Green Goats",color:dark_green},{text:" - ",color:gold},{score:{name:"team.GreenGoats",objective:"stats.points.team"},color:dark_green},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.CyanCougars stats.points.team.rank matches 2 run tellraw @a [{text:"#2: ",color:gold},{text:"Cyan Cougars",color:dark_aqua},{text:" - ",color:gold},{score:{name:"team.CyanCougars",objective:"stats.points.team"},color:dark_aqua},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PurplePenguins stats.points.team.rank matches 2 run tellraw @a [{text:"#2: ",color:gold},{text:"Purple Penguins",color:dark_purple},{text:" - ",color:gold},{score:{name:"team.PurplePenguins",objective:"stats.points.team"},color:dark_purple},{text:" points",color:gold}]

execute if score stmc.handler event.timer.bg1 matches 100 if score team.RedRaccoons stats.points.team.rank matches 3 run tellraw @a [{text:"#3: ",color:gold},{text:"Red Raccoons",color:red},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:red},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.OrangeOtters stats.points.team.rank matches 3 run tellraw @a [{text:"#3: ",color:gold},{text:"Orange Otters",color:gold},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:gold},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PinkPikas stats.points.team.rank matches 3 run tellraw @a [{text:"#3: ",color:gold},{text:"Pink Pikas",color:light_purple},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:light_purple},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.GreenGoats stats.points.team.rank matches 3 run tellraw @a [{text:"#3: ",color:gold},{text:"Green Goats",color:dark_green},{text:" - ",color:gold},{score:{name:"team.GreenGoats",objective:"stats.points.team"},color:dark_green},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.CyanCougars stats.points.team.rank matches 3 run tellraw @a [{text:"#3: ",color:gold},{text:"Cyan Cougars",color:dark_aqua},{text:" - ",color:gold},{score:{name:"team.CyanCougars",objective:"stats.points.team"},color:dark_aqua},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PurplePenguins stats.points.team.rank matches 3 run tellraw @a [{text:"#3: ",color:gold},{text:"Purple Penguins",color:dark_purple},{text:" - ",color:gold},{score:{name:"team.PurplePenguins",objective:"stats.points.team"},color:dark_purple},{text:" points",color:gold}]

execute if score stmc.handler event.timer.bg1 matches 100 if score team.RedRaccoons stats.points.team.rank matches 4 run tellraw @a [{text:"#4: ",color:gold},{text:"Red Raccoons",color:red},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:red},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.OrangeOtters stats.points.team.rank matches 4 run tellraw @a [{text:"#4: ",color:gold},{text:"Orange Otters",color:gold},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:gold},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PinkPikas stats.points.team.rank matches 4 run tellraw @a [{text:"#4: ",color:gold},{text:"Pink Pikas",color:light_purple},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:light_purple},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.GreenGoats stats.points.team.rank matches 4 run tellraw @a [{text:"#4: ",color:gold},{text:"Green Goats",color:dark_green},{text:" - ",color:gold},{score:{name:"team.GreenGoats",objective:"stats.points.team"},color:dark_green},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.CyanCougars stats.points.team.rank matches 4 run tellraw @a [{text:"#4: ",color:gold},{text:"Cyan Cougars",color:dark_aqua},{text:" - ",color:gold},{score:{name:"team.CyanCougars",objective:"stats.points.team"},color:dark_aqua},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PurplePenguins stats.points.team.rank matches 4 run tellraw @a [{text:"#4: ",color:gold},{text:"Purple Penguins",color:dark_purple},{text:" - ",color:gold},{score:{name:"team.PurplePenguins",objective:"stats.points.team"},color:dark_purple},{text:" points",color:gold}]

execute if score stmc.handler event.timer.bg1 matches 100 if score team.RedRaccoons stats.points.team.rank matches 5 run tellraw @a [{text:"#5: ",color:gold},{text:"Red Raccoons",color:red},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:red},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.OrangeOtters stats.points.team.rank matches 5 run tellraw @a [{text:"#5: ",color:gold},{text:"Orange Otters",color:gold},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:gold},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PinkPikas stats.points.team.rank matches 5 run tellraw @a [{text:"#5: ",color:gold},{text:"Pink Pikas",color:light_purple},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:light_purple},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.GreenGoats stats.points.team.rank matches 5 run tellraw @a [{text:"#5: ",color:gold},{text:"Green Goats",color:dark_green},{text:" - ",color:gold},{score:{name:"team.GreenGoats",objective:"stats.points.team"},color:dark_green},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.CyanCougars stats.points.team.rank matches 5 run tellraw @a [{text:"#5: ",color:gold},{text:"Cyan Cougars",color:dark_aqua},{text:" - ",color:gold},{score:{name:"team.CyanCougars",objective:"stats.points.team"},color:dark_aqua},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PurplePenguins stats.points.team.rank matches 5 run tellraw @a [{text:"#5: ",color:gold},{text:"Purple Penguins",color:dark_purple},{text:" - ",color:gold},{score:{name:"team.PurplePenguins",objective:"stats.points.team"},color:dark_purple},{text:" points",color:gold}]

execute if score stmc.handler event.timer.bg1 matches 100 if score team.RedRaccoons stats.points.team.rank matches 6 run tellraw @a [{text:"#6: ",color:gold},{text:"Red Raccoons",color:red},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:red},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.OrangeOtters stats.points.team.rank matches 6 run tellraw @a [{text:"#6: ",color:gold},{text:"Orange Otters",color:gold},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:gold},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PinkPikas stats.points.team.rank matches 6 run tellraw @a [{text:"#6: ",color:gold},{text:"Pink Pikas",color:light_purple},{text:" - ",color:gold},{score:{name:"team.RedRaccoons",objective:"stats.points.team"},color:light_purple},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.GreenGoats stats.points.team.rank matches 6 run tellraw @a [{text:"#6: ",color:gold},{text:"Green Goats",color:dark_green},{text:" - ",color:gold},{score:{name:"team.GreenGoats",objective:"stats.points.team"},color:dark_green},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.CyanCougars stats.points.team.rank matches 6 run tellraw @a [{text:"#6: ",color:gold},{text:"Cyan Cougars",color:dark_aqua},{text:" - ",color:gold},{score:{name:"team.CyanCougars",objective:"stats.points.team"},color:dark_aqua},{text:" points",color:gold}]
execute if score stmc.handler event.timer.bg1 matches 100 if score team.PurplePenguins stats.points.team.rank matches 6 run tellraw @a [{text:"#6: ",color:gold},{text:"Purple Penguins",color:dark_purple},{text:" - ",color:gold},{score:{name:"team.PurplePenguins",objective:"stats.points.team"},color:dark_purple},{text:" points",color:gold}]

# player rankings
execute if score stmc.handler event.timer.bg1 matches 200 run tellraw @a [{"text":"Player Rankings:","color":"gold","bold":true}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 1 run tellraw @a [{text:"#1: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 2 run tellraw @a [{text:"#2: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 3 run tellraw @a [{text:"#3: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 4 run tellraw @a [{text:"#4: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 5 run tellraw @a [{text:"#5: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 6 run tellraw @a [{text:"#6: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 7 run tellraw @a [{text:"#7: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 8 run tellraw @a [{text:"#8: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 9 run tellraw @a [{text:"#9: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 10 run tellraw @a [{text:"#10: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 11 run tellraw @a [{text:"#11: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 12 run tellraw @a [{text:"#12: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 13 run tellraw @a [{text:"#13: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 14 run tellraw @a [{text:"#14: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 15 run tellraw @a [{text:"#15: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 16 run tellraw @a [{text:"#16: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 17 run tellraw @a [{text:"#17: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 18 run tellraw @a [{text:"#18: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 19 run tellraw @a [{text:"#19: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 20 run tellraw @a [{text:"#20: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 21 run tellraw @a [{text:"#21: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 22 run tellraw @a [{text:"#22: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 23 run tellraw @a [{text:"#23: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]
execute as @a if score stmc.handler event.timer.bg1 matches 200 if score @s stats.points.indiv.rank matches 24 run tellraw @a [{text:"#24: ",color:gold},{selector:"@s"},{text:" - ",color:gold},{score:{name:"@s",objective:"stats.points.indiv"},color:red},{text:" points",color:gold}]

# announce next game

execute unless score stmc.handler event.stage matches 6 unless score stmc.handler event.stage matches 12 if score stmc.handler event.timer.bg1 matches 300 run tellraw @a [{"text":"Teleporting to next game in one minute!","color":"white","bold":true}]
execute if score stmc.handler event.stage matches 12 if score stmc.handler event.timer.bg1 matches 300 run tellraw @a [{"text":"Teleporting to finale in thirty seconds!","color":"white","bold":true}]
execute if score stmc.handler event.stage matches 6 if score stmc.handler event.timer.bg1 matches 300 run tellraw @a [{"text":"Break! Teleporting to next game in six minutes!","color":"white","bold":true}]

execute if score stmc.handler event.stage matches 2 if score stmc.handler event.timer.bg1 matches 1500 run title @a title {text:"Solve",color:yellow,bold:true}
execute if score stmc.handler event.stage matches 4 if score stmc.handler event.timer.bg1 matches 1500 run title @a title {text:"Extract",color:red,bold:true}
execute if score stmc.handler event.stage matches 6 if score stmc.handler event.timer.bg1 matches 7500 run title @a title {text:"Trials",color:dark_aqua,bold:true}
execute if score stmc.handler event.stage matches 8 if score stmc.handler event.timer.bg1 matches 1500 run title @a title {text:"Delve",color:light_purple,bold:true}
execute if score stmc.handler event.stage matches 10 if score stmc.handler event.timer.bg1 matches 1500 run title @a title {text:"Brawl",color:gold,bold:true}
execute if score stmc.handler event.stage matches 12 if score stmc.handler event.timer.bg1 matches 900 run title @a title {text:"Dodgebolt",color:white,bold:true}

# move to next game
execute unless score stmc.handler event.stage matches 6 unless score stmc.handler event.stage matches 12 if score stmc.handler event.timer.bg1 matches 1560 run scoreboard players add stmc.handler event.stage 1
execute if score stmc.handler event.stage matches 12 if score stmc.handler event.timer.bg1 matches 960 run scoreboard players add stmc.handler event.stage 1
execute if score stmc.handler event.stage matches 6 if score stmc.handler event.timer.bg1 matches 7560 run scoreboard players add stmc.handler event.stage 1